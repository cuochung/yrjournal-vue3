import{g as ne,u as X,r as x,h as r,c as h,m as y,e as t,w as l,k as a,j as se,b as o,F as Q,p as W,t as c,A as re,a as ue,T as ce,y as J,z as me,d as T,B as fe,C as ve,n as de}from"./index-DtepjGgS.js";import{_ as pe}from"./gear-KB1inu7G.js";import{d as F}from"./dayjs.min-B9RCbytb.js";import{a as K}from"./api-Dwt0tebd.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ye}from"./PaginatedIterator-BwvfNgT7.js";const ke={class:"PatchInputForm"},ge={__name:"PatchInputForm",props:{checkedItems:{type:Array,required:!0}},emits:["getAllData"],setup(H,{emit:E}){const{proxy:S}=ne(),b=X(),$=H,C=E,g=x(!1),s=x([]),d=x(null),n=[P=>!!P||"不可空白"],w=()=>{console.log($.checkedItems),g.value=!0,s.value=$.checkedItems.map(P=>({customerInfo:P,date:F().format("YYYY-MM-DD")}))},O=async()=>{const{valid:P}=await d.value.validate();P?S.$swal({title:"確認完成作業？？?",icon:"warning",toast:!1,timer:null,showConfirmButton:!0,showCancelButton:!0,position:"center"}).then(async _=>{if(_.isConfirmed){const U=s.value.map(f=>({Date:f.date,customerInfo:{text:`${f.customerInfo.name} - ${f.customerInfo.cellphone}`,customerInfo:{snkey:f.customerInfo.snkey,name:f.customerInfo.name,cellphone:f.customerInfo.cellphone}},price:f.price,note:f.note,rewardPoint:f.rewardPoint,usePoint:f.usePoint,createInfo:{name:b.state.pData.name,time:F().format("YYYY-MM-DD HH:mm:ss")}})).map(f=>({datalist:JSON.stringify(f)})),A=`general/addMulti/${b.state.databaseName}/purchase_record`,Y=await K.options(A,U);Y.every(f=>f.state===!0)?(S.$swal({icon:"success",title:`批次輸入成功, 新增筆數: ${Y.length}`}),C("getAllData"),g.value=!1):S.$swal({icon:"error",title:"批次輸入過程有誤，請聯絡系統服務商"})}}):S.$swal({icon:"error",title:"請確認資料完整性!!"})};return(P,_)=>{const N=r("v-btn"),U=r("v-spacer"),A=r("v-icon"),Y=r("v-card-title"),B=r("v-divider"),f=r("v-text-field"),R=r("v-data-table"),q=r("v-form"),z=r("v-card-text"),u=r("v-card-actions"),e=r("v-card"),k=r("v-dialog");return y(),h("div",ke,[t(k,{modelValue:g.value,"onUpdate:modelValue":_[2]||(_[2]=i=>g.value=i),width:"auto",fullscreen:""},{activator:l(({props:i})=>[t(N,re({class:"bg-primary"},i,{onClick:w}),{default:l(()=>[..._[3]||(_[3]=[a("批次輸入消費資料",-1)])]),_:2},1040)]),default:l(()=>[t(e,null,{default:l(()=>[t(Y,{class:"d-flex justify-space-between"},{default:l(()=>[_[5]||(_[5]=a(" 批次輸入消費資料 ",-1)),t(U),t(A,{onClick:_[0]||(_[0]=se(i=>g.value=!1,["stop"]))},{default:l(()=>[..._[4]||(_[4]=[a("mdi-close",-1)])]),_:1})]),_:1}),t(B),t(z,null,{default:l(()=>[t(q,{ref_key:"form",ref:d},{default:l(()=>[t(R,{"fixed-header":"",class:"text-no-wrap"},{default:l(()=>[_[6]||(_[6]=o("thead",null,[o("tr",null,[o("th",{class:"text-left text-h6",width:"200"},"會員名稱"),o("th",{class:"text-left text-h6",width:"120"},"剩餘點數"),o("th",{class:"text-left text-h6",width:"200"},"日期"),o("th",{class:"text-left text-h6",width:"200"},"消費金額"),o("th",{class:"text-left text-h6",width:"200"},"回饋點數"),o("th",{class:"text-left text-h6",width:"200"},"使用點數"),o("th",{class:"text-left text-h6"},"備註")])],-1)),o("tbody",null,[(y(!0),h(Q,null,W(s.value,(i,V)=>(y(),h("tr",{key:V},[o("td",null,c(i.customerInfo.name)+" "+c(i.customerInfo.sex),1),o("td",null,c(i.customerInfo.rewardPoint-i.customerInfo.usePoint),1),o("td",null,[t(f,{modelValue:i.date,"onUpdate:modelValue":m=>i.date=m,type:"date"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[t(f,{modelValue:i.price,"onUpdate:modelValue":m=>i.price=m,type:"number",rules:n},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[t(f,{modelValue:i.rewardPoint,"onUpdate:modelValue":m=>i.rewardPoint=m,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[t(f,{modelValue:i.usePoint,"onUpdate:modelValue":m=>i.usePoint=m,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),o("td",null,[t(f,{modelValue:i.note,"onUpdate:modelValue":m=>i.note=m,type:"text"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1})]),_:1},512)]),_:1}),t(u,null,{default:l(()=>[t(U),t(N,{class:"bg-primary",onClick:_[1]||(_[1]=i=>O())},{default:l(()=>[..._[7]||(_[7]=[a("完成作業",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},we={class:"OrderInfo"},xe={class:"memberInfoZone"},be={class:"grey lighten-4 rounded pa-2"},Ve={class:"grey lighten-4 rounded pa-2"},Pe={__name:"OrderInfo",props:{list:{type:Object,required:!0}},setup(H){const E=X(),S=H,b=x([]),$=g=>{const s=F();return b.value.reduce((d,n)=>{if(!n.price||!n.Date)return d;const w=F(n.Date);if(g==="year"){if(w.year()===s.year())return d+Number(n.price)}else if(g==="lastyear"){if(w.year()===s.year()-1)return d+Number(n.price)}else if(g==="month"){if(w.year()===s.year()&&w.month()===s.month())return d+Number(n.price)}else return d+Number(n.price);return d},0)},C=g=>b.value.reduce((s,d)=>s+Number(d[g]||0),0);return ue(async()=>{try{const g={key:"customerInfo.customerInfo.snkey",value:S.list.snkey},s=await K.options(`byjson/searchByKeyValue/${E.state.databaseName}/purchase_record`,g);console.log("購買記錄",s),s.length>0&&(b.value=s.map(d=>({...JSON.parse(d.datalist),snkey:d.snkey})))}catch(g){console.error("Error fetching purchase records:",g)}}),(g,s)=>{const d=r("v-icon"),n=r("v-col"),w=r("v-row"),O=r("v-divider"),P=r("v-data-table"),_=r("v-data-iterator"),N=r("v-form"),U=r("v-card-text"),A=r("v-card");return y(),h("div",we,[t(A,null,{default:l(()=>[s[14]||(s[14]=o("div",{class:"d-flex justify-center px-2 py-2 bg-grey-lighten-3"},[o("h3",{class:"font-weight-bold text-grey-darken-2"}," 相關記錄 ")],-1)),t(U,{class:"pa-1"},{default:l(()=>[t(N,{ref:"form"},{default:l(()=>[t(ce,{name:"slide-fade2",mode:"out-in"},{default:l(()=>[o("div",xe,[o("div",be,[s[10]||(s[10]=o("h3",null,"會員資料",-1)),s[11]||(s[11]=o("hr",null,null,-1)),t(w,{class:"mt-1"},{default:l(()=>[t(n,{cols:"12",sm:"4"},{default:l(()=>[o("h3",null,[t(d,{color:"indigo darken-2",left:""},{default:l(()=>[...s[0]||(s[0]=[a("mdi-account",-1)])]),_:1}),a(" "+c(H.list.name)+" "+c(H.list.sex),1)])]),_:1}),t(n,{cols:"12",sm:"4"},{default:l(()=>[o("h3",null,[t(d,{color:"teal darken-2",left:""},{default:l(()=>[...s[1]||(s[1]=[a("mdi-cellphone",-1)])]),_:1}),a(" "+c(H.list.cellphone),1)])]),_:1}),t(n,{cols:"12",sm:"4"},{default:l(()=>[o("h3",null,[t(d,{color:"amber darken-2",left:""},{default:l(()=>[...s[2]||(s[2]=[a("mdi-medal",-1)])]),_:1}),a(" "+c(H.list.level),1)])]),_:1})]),_:1}),t(O,{class:"my-2"}),t(w,null,{default:l(()=>[t(n,{cols:"12",sm:"3"},{default:l(()=>[o("h3",null,[t(d,{left:"",color:"amber darken-2"},{default:l(()=>[...s[3]||(s[3]=[a("mdi-cash-multiple",-1)])]),_:1}),a(" 總消費金額："+c($("total")),1)])]),_:1}),t(n,{cols:"12",sm:"3"},{default:l(()=>[o("h3",null,[t(d,{left:"",color:"warning darken-2"},{default:l(()=>[...s[4]||(s[4]=[a("mdi-calendar-range",-1)])]),_:1}),a(" 去年度消費金額："+c($("lastyear")),1)])]),_:1}),t(n,{cols:"12",sm:"3"},{default:l(()=>[o("h3",null,[t(d,{left:"",color:"blue darken-2"},{default:l(()=>[...s[5]||(s[5]=[a("mdi-calendar-range",-1)])]),_:1}),a(" 本年度消費金額："+c($("year")),1)])]),_:1}),t(n,{cols:"12",sm:"3"},{default:l(()=>[o("h3",null,[t(d,{left:"",color:"green darken-2"},{default:l(()=>[...s[6]||(s[6]=[a("mdi-calendar-month",-1)])]),_:1}),a(" 本月消費金額："+c($("month")),1)])]),_:1})]),_:1}),t(w,null,{default:l(()=>[t(n,{cols:"12",sm:"4"},{default:l(()=>[o("h3",null,[t(d,{left:"",color:"amber darken-2"},{default:l(()=>[...s[7]||(s[7]=[a("mdi-star-circle",-1)])]),_:1}),a(" 總回饋點數："+c(C("rewardPoint")),1)])]),_:1}),t(n,{cols:"12",sm:"4"},{default:l(()=>[o("h3",null,[t(d,{left:"",color:"red darken-2"},{default:l(()=>[...s[8]||(s[8]=[a("mdi-star-off",-1)])]),_:1}),a(" 已使用點數："+c(C("usePoint")),1)])]),_:1}),t(n,{cols:"12",sm:"4"},{default:l(()=>[o("h3",null,[t(d,{left:"",color:"green darken-2"},{default:l(()=>[...s[9]||(s[9]=[a("mdi-star",-1)])]),_:1}),a(" 剩餘點數："+c(C("rewardPoint")-C("usePoint")),1)])]),_:1})]),_:1})]),t(O,{class:"my-2"}),o("div",Ve,[s[13]||(s[13]=o("h3",null,"消費記錄",-1)),t(O,{class:"mb-2"}),t(_,{items:b.value},{default:l(({items:Y})=>[t(P,{"fixed-header":"",class:"text-no-wrap"},{default:l(()=>[s[12]||(s[12]=o("thead",null,[o("tr",null,[o("th",{class:"text-left"},"日期"),o("th",{class:"text-left"},"消費金額"),o("th",{class:"text-left"},"回饋點數"),o("th",{class:"text-left"},"使用點數")])],-1)),o("tbody",null,[(y(!0),h(Q,null,W(Y,(B,f)=>(y(),h("tr",{key:f},[o("td",null,c(B.raw.Date),1),o("td",null,c(B.raw.price),1),o("td",null,c(B.raw.rewardPoint),1),o("td",null,c(B.raw.usePoint),1)]))),128))])]),_:2},1024)]),_:1},8,["items"])])])]),_:1})]),_:1},512)]),_:1})]),_:1})])}}},De=_e(Pe,[["__scopeId","data-v-76efb185"]]),Ie={class:"customeradd"},he={key:0},$e={__name:"Add",props:{usingDatabase:String,useingItems:Array},emits:["getAllData"],setup(H,{expose:E,emit:S}){const{proxy:b}=ne(),$=X(),C=H,g=S,s=x(null),d=x(!1),n=x({}),w=x(""),O=x(""),P=x(""),_=x(""),N=x(!1),U=[u=>!!u||"不可空白"],A=["先生","小姐"],Y=u=>{if(C.useingItems.find(k=>k.cellphone==u)){if(w.value=="add")return b.$swal({icon:"error",title:"手機號碼已存在,請再確認!!"}),!0;if(_.value.cellphone!=u)return b.$swal({icon:"error",title:"手機號碼已存在,請再確認!!"}),!0}return!1},B=()=>{w.value="add",O.value="新增會員資料",P.value="bg-primary",d.value=!0,ve(()=>{s.value&&s.value.resetValidation?.()})},f=u=>{w.value="edit",O.value="修改會員資料",P.value="bg-success",_.value=u,n.value=JSON.parse(JSON.stringify(u)),d.value=!0},R=u=>{w.value="readonly",O.value="瀏覽會員資料",P.value="bg-warning",n.value=JSON.parse(JSON.stringify(u)),d.value=!0},q=async()=>{const{valid:u}=await s.value?.validate()||{valid:!1};if(u){if(Y(n.value.cellphone))return!1;n.value.createInfo={name:$.state.pData.name,time:F().format("YYYY-MM-DD HH:mm:ss")};const e={datalist:JSON.stringify(n.value)};try{N.value=!0,(await K.add(C.usingDatabase,e)).state==1&&(b.$swal({icon:"success",title:"已新增"}),g("getAllData"),d.value=!1)}catch(k){b.$swal({icon:"error",title:"資料存取錯誤!!內容:"+k})}finally{N.value=!1}}else b.$swal({icon:"error",title:"資料輸入不完整!!請再次確認!!"})},z=async()=>{const{valid:u}=await s.value?.validate()||{valid:!1};if(u){if(Y(n.value.cellphone))return!1;n.value.editInfo||(n.value.editInfo=[]),n.value.editInfo.unshift({name:$.state.pData.name,time:F().format("YYYY-MM-DD HH:mm:ss")});const e={snkey:n.value.snkey,datalist:JSON.stringify(n.value)};try{(await K.post(C.usingDatabase,e)).state==1&&(b.$swal({icon:"success",title:"已修改"}),g("getAllData"),d.value=!1)}catch(k){b.$swal({icon:"error",title:"資料存取錯誤!!內容:"+k})}}else b.$swal({icon:"error",title:"資料輸入不完整!!請再次確認!!"})};return E({editProcess:f,readonlyProcess:R}),(u,e)=>{const k=r("v-icon"),i=r("v-spacer"),V=r("v-card-title"),m=r("v-text-field"),D=r("v-col"),I=r("v-select"),ee=r("v-checkbox"),G=r("v-textarea"),L=r("v-row"),te=r("v-form"),le=r("v-card-text"),oe=r("v-divider"),Z=r("v-btn"),ae=r("v-card-actions"),M=r("v-card"),v=r("v-dialog");return y(),h("div",Ie,[t(v,{modelValue:d.value,"onUpdate:modelValue":e[11]||(e[11]=p=>d.value=p),width:"auto",fullscreen:""},{activator:l(({on:p})=>[t(k,re({class:"text-red"},fe({...p,click:B})),{default:l(()=>[...e[12]||(e[12]=[a("mdi-plus-circle",-1)])]),_:2},1040)]),default:l(()=>[t(M,null,{default:l(()=>[t(V,{class:me(["d-flex justify-space-between",P.value])},{default:l(()=>[a(c(O.value)+" ",1),t(i),t(k,{onClick:e[0]||(e[0]=se(p=>d.value=!1,["stop"]))},{default:l(()=>[...e[13]||(e[13]=[a("mdi-close",-1)])]),_:1})]),_:1},8,["class"]),t(le,null,{default:l(()=>[t(te,{ref_key:"form",ref:s,readonly:w.value=="readonly"},{default:l(()=>[t(L,null,{default:l(()=>[t(D,{cols:"12",sm:"4"},{default:l(()=>[t(m,{label:"會員名稱","prepend-icon":"mdi-account",modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=p=>n.value.name=p),autofocus:"",rules:U},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(I,{label:"稱謂","prepend-icon":"mdi-account",items:A,modelValue:n.value.sex,"onUpdate:modelValue":e[2]||(e[2]=p=>n.value.sex=p),rules:U},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(m,{label:"手機","prepend-icon":"mdi-cellphone",modelValue:n.value.cellphone,"onUpdate:modelValue":e[3]||(e[3]=p=>n.value.cellphone=p),rules:U},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(m,{label:"IG帳號/FB名字","prepend-icon":"mdi-account-circle",modelValue:n.value.socialName,"onUpdate:modelValue":e[4]||(e[4]=p=>n.value.socialName=p)},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(m,{label:"身份證字號","prepend-icon":"mdi-card-account-details",modelValue:n.value.idNumber,"onUpdate:modelValue":e[5]||(e[5]=p=>n.value.idNumber=p)},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(m,{label:"生日","prepend-icon":"mdi-cake-variant",type:"date",modelValue:n.value.birthday,"onUpdate:modelValue":e[6]||(e[6]=p=>n.value.birthday=p)},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(m,{label:"Email 信箱","prepend-icon":"mdi-email",type:"email",modelValue:n.value.email,"onUpdate:modelValue":e[7]||(e[7]=p=>n.value.email=p)},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(m,{label:"會員等級","prepend-icon":"mdi-medal",modelValue:n.value.level,"onUpdate:modelValue":e[8]||(e[8]=p=>n.value.level=p)},null,8,["modelValue"])]),_:1}),t(D,{cols:"12",sm:"4"},{default:l(()=>[t(ee,{label:"黑名單","prepend-icon":"fa-solid fa-user-slash",modelValue:n.value.blacklist,"onUpdate:modelValue":e[9]||(e[9]=p=>n.value.blacklist=p)},null,8,["modelValue"])]),_:1}),t(D,{cols:"12"},{default:l(()=>[t(G,{label:"備註資料","prepend-icon":"mdi-note",modelValue:n.value.note,"onUpdate:modelValue":e[10]||(e[10]=p=>n.value.note=p),"auto-grow":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["readonly"])]),_:1}),t(oe),t(ae,null,{default:l(()=>[t(i),w.value=="add"?(y(),T(Z,{key:0,class:"bg-primary",onClick:q,loading:N.value,disabled:N.value},{default:l(()=>[...e[14]||(e[14]=[a("確認新增",-1)])]),_:1},8,["loading","disabled"])):J("",!0),w.value=="edit"?(y(),T(Z,{key:1,class:"bg-success",onClick:z},{default:l(()=>[...e[15]||(e[15]=[a("確認修改",-1)])]),_:1})):J("",!0)]),_:1}),w.value=="readonly"?(y(),h("div",he,[t(De,{list:n.value},null,8,["list"])])):J("",!0)]),_:1})]),_:1},8,["modelValue"])])}}},Ce={class:"customerlist"},Ne={class:"d-flex align-center gap-20 mr-3"},Ue={key:0},Oe={class:"title"},Ye={class:"text-left"},Se={class:"text-left"},Ae={class:"text-left"},Be={class:"text-left"},Me={class:"text-left"},Je={class:"text-left"},He={class:"text-left"},je={class:"text-left"},Te={class:"text-left"},Fe={class:"text-left"},Ee={class:"text-left"},Ke={class:"text-left"},Re={class:"text-left"},qe={class:"text-left"},ze=["onClick"],Ge={class:"pa-0 d-flex justify-center align-center"},Le={key:0,class:"red--text"},Ze={class:"text-truncate",style:{"max-width":"200px"}},Qe={key:0,class:"text-truncate",style:{"max-width":"500px"}},at={__name:"index",setup(H){const{proxy:E}=ne(),S=X(),b=x(null),$=x("customer"),C=x([]),g=x(""),s=x(""),d=x(!1),n=x(!1),w=x([]),O=x(1),P=x(10),_=[{value:5,title:"5"},{value:10,title:"10"},{value:25,title:"25"}],N=de(()=>{const u=g.value.split(" ");let e="",k=u.reduce((i,V)=>i.filter(m=>{if(e=JSON.stringify(m).toUpperCase(),e.includes(V.toUpperCase()))return m}),C.value);return console.log("matchs",k),k}),U=de(()=>N.value.filter(u=>u.isChecked)),A=(u,e)=>{const k=F();return w.value.filter(V=>V.customerInfo.customerInfo.snkey==u.snkey).reduce((V,m)=>{if(!m.price||!m.Date)return V;const D=F(m.Date);if(e==="year"){if(D.year()===k.year())return V+Number(m.price)}else if(e==="month"){if(D.year()===k.year()&&D.month()===k.month())return V+Number(m.price)}else return V+Number(m.price);return V},0)},Y=(u,e)=>w.value.filter(i=>i.customerInfo.customerInfo.snkey==u.snkey).reduce((i,V)=>i+Number(V[e]||0),0),B=()=>{N.value.forEach(u=>{u.isChecked=n.value})},f=async()=>{const u=await K.get($.value);console.log("customer rs",u),C.value=u.map(e=>({...JSON.parse(e.datalist),snkey:e.snkey,isChecked:!1})).map(e=>({...e,totalPrice:A(e,"total"),yearPrice:A(e,"year"),monthPrice:A(e,"month"),rewardPoint:Y(e,"rewardPoint"),usePoint:Y(e,"usePoint")}))},R=u=>{b.value.readonlyProcess(u.raw)},q=u=>{b.value.editProcess(u)},z=u=>{E.$swal({title:"確認要刪除嗎?",text:"此操作無法復原",icon:"warning",toast:!1,timer:null,showConfirmButton:!0,showCancelButton:!0,position:"center"}).then(async e=>{if(e.isConfirmed){u.delInfo={name:S.state.pData.name,time:F().format("YYYY-MM-DD HH:mm:ss")};const k={snkey:u.snkey,tablename:$.value,datalist:JSON.stringify(u)},i=await K.delete($.value,k);console.log("delete rs",i),i.state==1&&(E.$swal({icon:"success",title:"刪除成功",toast:!0,confirmButtonText:"確定",confirmButtonColor:"#3085d6",allowOutsideClick:!1,allowEscapeKey:!1}),f())}})};return ue(async()=>{s.value=S.state.pData,w.value=await K.get("purchase_record").then(u=>u.map(e=>({...JSON.parse(e.datalist),snkey:e.snkey}))),await f()}),(u,e)=>{const k=r("v-spacer"),i=r("v-checkbox"),V=r("v-text-field"),m=r("v-toolbar"),D=r("v-card-title"),I=r("v-icon"),ee=r("v-btn"),G=r("v-list-item-title"),L=r("v-list-item"),te=r("v-list"),le=r("v-menu"),oe=r("v-table"),Z=r("v-card-text"),ae=r("v-card");return y(),h("div",Ce,[t(ae,null,{default:l(()=>[t(D,null,{default:l(()=>[t(m,{rounded:"",class:"bg-white"},{default:l(()=>[e[7]||(e[7]=o("span",{class:"mr-3 font-weight-bold"},"會員管理&批次消費作業",-1)),t(k),o("div",Ne,[d.value&&U.value.length>0?(y(),h("div",Ue,[t(ge,{checkedItems:U.value},null,8,["checkedItems"])])):J("",!0),t(i,{label:"批次作業",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=M=>d.value=M),"hide-details":"",class:"mr-5"},null,8,["modelValue"])]),s.value.customer_search_key?(y(),T(V,{key:0,"hide-details":"","prepend-inner-icon":"mdi-magnify","single-line":"",label:"搜尋",modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=M=>g.value=M)},null,8,["modelValue"])):J("",!0),s.value.customer_add_key?(y(),T($e,{key:1,ref_key:"childFn",ref:b,class:"ml-2",usingDatabase:$.value,useingItems:C.value,onGetAllData:f},null,8,["usingDatabase","useingItems"])):J("",!0)]),_:1})]),_:1}),t(Z,null,{default:l(()=>[t(ye,{items:N.value,page:O.value,"onUpdate:page":e[5]||(e[5]=M=>O.value=M),"items-per-page":P.value,"onUpdate:itemsPerPage":e[6]||(e[6]=M=>P.value=M),"items-per-page-options":_},{default:l(({items:M})=>[t(oe,{"fixed-header":"",class:"text-no-wrap","hide-default-footer":""},{default:l(()=>[o("thead",Oe,[o("tr",null,[o("th",null,[d.value?(y(),T(i,{key:0,label:`${n.value?"全不選":"全選"} (${U.value.length})`,modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=v=>n.value=v),onChange:e[3]||(e[3]=v=>B()),width:"150","hide-details":""},null,8,["label","modelValue"])):J("",!0)]),o("th",Ye,[t(I,{small:"",color:"grey darken-2"},{default:l(()=>[...e[8]||(e[8]=[a("mdi-identifier",-1)])]),_:1}),e[9]||(e[9]=a(" ID",-1))]),o("th",Se,[t(I,{small:"",color:"red darken-2"},{default:l(()=>[...e[10]||(e[10]=[a("mdi-alert-circle",-1)])]),_:1}),e[11]||(e[11]=a(" 黑名單",-1))]),o("th",Ae,[t(I,{small:"",color:"indigo darken-2"},{default:l(()=>[...e[12]||(e[12]=[a("mdi-account",-1)])]),_:1}),e[13]||(e[13]=a(" 會員名稱",-1))]),o("th",Be,[t(I,{small:"",color:"teal darken-2"},{default:l(()=>[...e[14]||(e[14]=[a("mdi-cellphone",-1)])]),_:1}),e[15]||(e[15]=a(" 手機",-1))]),o("th",Me,[t(I,{small:"",color:"amber darken-2"},{default:l(()=>[...e[16]||(e[16]=[a("mdi-medal",-1)])]),_:1}),e[17]||(e[17]=a(" 會員等級",-1))]),o("th",Je,[t(I,{small:"",color:"amber darken-2"},{default:l(()=>[...e[18]||(e[18]=[a("mdi-cash-multiple",-1)])]),_:1}),e[19]||(e[19]=a(" 總消費金額",-1))]),o("th",He,[t(I,{small:"",color:"blue darken-2"},{default:l(()=>[...e[20]||(e[20]=[a("mdi-calendar-range",-1)])]),_:1}),e[21]||(e[21]=a(" 本年消費金額",-1))]),o("th",je,[t(I,{small:"",color:"green darken-2"},{default:l(()=>[...e[22]||(e[22]=[a("mdi-calendar-month",-1)])]),_:1}),e[23]||(e[23]=a(" 本月消費金額",-1))]),o("th",Te,[t(I,{small:"",color:"amber darken-2"},{default:l(()=>[...e[24]||(e[24]=[a("mdi-star-circle",-1)])]),_:1}),e[25]||(e[25]=a(" 總回饋點數",-1))]),o("th",Fe,[t(I,{small:"",color:"red darken-2"},{default:l(()=>[...e[26]||(e[26]=[a("mdi-star-off",-1)])]),_:1}),e[27]||(e[27]=a(" 已使用回饋點數",-1))]),o("th",Ee,[t(I,{small:"",color:"green darken-2"},{default:l(()=>[...e[28]||(e[28]=[a("mdi-star",-1)])]),_:1}),e[29]||(e[29]=a(" 剩餘回饋點數",-1))]),o("th",Ke,[t(I,{small:"",color:"grey darken-2"},{default:l(()=>[...e[30]||(e[30]=[a("mdi-note-text",-1)])]),_:1}),e[31]||(e[31]=a(" 備註資料",-1))]),o("th",Re,[t(I,{small:"",color:"blue darken-2"},{default:l(()=>[...e[32]||(e[32]=[a("mdi-account-plus",-1)])]),_:1}),e[33]||(e[33]=a(" 創建紀錄",-1))]),o("th",qe,[t(I,{small:"",color:"blue darken-2"},{default:l(()=>[...e[34]||(e[34]=[a("mdi-pencil",-1)])]),_:1}),e[35]||(e[35]=a(" 修改紀錄",-1))])])]),o("tbody",null,[(y(!0),h(Q,null,W(M,(v,p)=>(y(),h("tr",{key:p,onClick:j=>!d.value&&R(v)},[o("td",Ge,[d.value?(y(),T(i,{key:0,modelValue:v.raw.isChecked,"onUpdate:modelValue":j=>v.raw.isChecked=j,"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])):(y(),T(le,{key:1,transition:"scale-transition","offset-y":"",onClick:e[4]||(e[4]=se(()=>{},["stop"]))},{activator:l(({props:j})=>[t(ee,re({variant:"text"},{ref_for:!0},j),{default:l(()=>[...e[36]||(e[36]=[o("img",{src:pe,alt:""},null,-1)])]),_:2},1040)]),default:l(()=>[t(te,null,{default:l(()=>[s.value.customer_edit_key?(y(),T(L,{key:0,onClick:j=>q(v.raw)},{default:l(()=>[t(G,null,{default:l(()=>[...e[37]||(e[37]=[a("修改",-1)])]),_:1})]),_:2},1032,["onClick"])):J("",!0),s.value.customer_del_key?(y(),T(L,{key:1,onClick:j=>z(v.raw)},{default:l(()=>[t(G,null,{default:l(()=>[...e[38]||(e[38]=[a("刪除",-1)])]),_:1})]),_:2},1032,["onClick"])):J("",!0)]),_:2},1024)]),_:2},1024))]),o("td",null,c(v.raw.snkey),1),o("td",null,[v.blacklist?(y(),h("span",Le,"✔")):J("",!0)]),o("td",null,c(v.raw.name)+" "+c(v.raw.sex),1),o("td",null,c(v.raw.cellphone),1),o("td",null,c(v.raw.level),1),o("td",null,c(v.raw.totalPrice),1),o("td",null,c(v.raw.yearPrice),1),o("td",null,c(v.raw.monthPrice),1),o("td",null,c(v.raw.rewardPoint),1),o("td",null,c(v.raw.usePoint),1),o("td",null,c(v.raw.rewardPoint-v.raw.usePoint),1),o("td",Ze,c(v.raw.note),1),o("td",null,c(`${v.raw.createInfo.name}(${v.raw.createInfo.time})`),1),o("td",null,[v.raw.editInfo?(y(),h("div",Qe,[(y(!0),h(Q,null,W(v.raw.editInfo,(j,ie)=>(y(),h("span",{key:ie},c(`${j.name}(${j.time})`),1))),128))])):J("",!0)])],8,ze))),128))])]),_:2},1024)]),_:1},8,["items","page","items-per-page"])]),_:1})]),_:1})])}}};export{at as default};
