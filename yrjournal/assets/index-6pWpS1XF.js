import{h as e,c as N,m as u,e as n,w as i,z as j,k as _,t as V,j as H,F as z,p as K,d as B,b as f,y as W,g as E,u as G,r as a,n as P,a as q}from"./index-DtepjGgS.js";import{d as Q}from"./dayjs.min-B9RCbytb.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as J}from"./api-Dwt0tebd.js";const X={props:["usingDatabase","items","weekContentItems"],data(){return{dialog:!1,processType:"",title:"",titleStyle:"",emptyRules:[d=>!!d||"不可空白"],listItems:null,selectWeek:"日"}},methods:{editProcess(d){this.processType="edit",this.title="顯示資料-星期"+d,this.titleStyle="font-weight-black success lighten-2",this.listItems=this.items.filter(s=>s.week==d),this.dialog=!0},copyOK(){let d=this.listItems.map(o=>{let m={time:o.time,week:this.selectWeek,maxUsers:o.maxUsers,createInfo:{name:this.$store.state.pData.name,time:Q().format("YYYY-MM-DD HH:mm:ss")}};return{datalist:JSON.stringify(m)}}),s="general/addMulti/"+this.$store.state.databaseName+"/"+this.usingDatabase;this.$api.options(s,d).then(o=>{o.state==1&&(this.$alert({icon:"success",title:"已新增"}),this.$emit("getAllData"),this.dialog=!1)})}}},Z={class:"WeekContent"};function tt(d,s,o,m,r,y){const v=e("v-spacer"),g=e("v-icon"),k=e("v-card-title"),p=e("v-select"),D=e("v-alert"),x=e("v-card-text"),S=e("v-divider"),I=e("v-btn"),w=e("v-card-actions"),C=e("v-card"),b=e("v-dialog");return u(),N("div",Z,[n(b,{modelValue:r.dialog,"onUpdate:modelValue":s[2]||(s[2]=c=>r.dialog=c),width:"auto"},{default:i(()=>[n(C,null,{default:i(()=>[n(k,{class:j(r.titleStyle),"primary-title":""},{default:i(()=>[_(V(r.title)+" ",1),n(v),n(g,{onClick:s[0]||(s[0]=H(c=>r.dialog=!1,["stop"]))},{default:i(()=>[...s[3]||(s[3]=[_("mdi-close",-1)])]),_:1})]),_:1},8,["class"]),n(x,null,{default:i(()=>[n(p,{label:"複制所有資料到星期",items:o.weekContentItems,modelValue:r.selectWeek,"onUpdate:modelValue":s[1]||(s[1]=c=>r.selectWeek=c)},null,8,["items","modelValue"]),(u(!0),N(z,null,K(r.listItems,(c,h)=>(u(),B(D,{class:"grey lighten-1 ma-1 pa-1",key:h},{default:i(()=>[f("h3",null,V(c.time)+" - 人數:"+V(c.maxUsers?c.maxUsers:"未設定"),1)]),_:2},1024))),128))]),_:1}),n(S),n(w,null,{default:i(()=>[n(v),r.processType=="edit"?(u(),B(I,{key:0,class:"success",onClick:y.copyOK},{default:i(()=>[...s[4]||(s[4]=[_("複制",-1)])]),_:1},8,["onClick"])):W("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const et=M(X,[["render",tt]]),st={class:"OrdersetList"},at={class:"grey lighten-4 rounded pa-2"},nt={key:1,class:"mt-2"},F="orderset",ot={__name:"index",setup(d){const{proxy:s}=E(),o=G(),m=a([]),r=["日","一","二","三","四","五","六"];a({time:"00:00"});const y=a(0),v=a(0),g=a([]),k=a([]),p=a(""),D=a(""),x=a([]);a({});const S=a([]);a({}),a(null),a(""),a(null);const I=a(null);a(null);const w=P(()=>!!m.value);q(async()=>{b(),await h(),await C()});const C=async()=>{y.value=o.state.cData.maxday,v.value=o.state.cData.maxOrderCounts,g.value=JSON.parse(o.state.cData.holidaySet),k.value=JSON.parse(o.state.cData.additionalHolidaySet),p.value=o.state.cData.introduce,D.value=o.state.cData.memberOnly,S.value=JSON.parse(o.state.cData.allBookingSet).sort((l,t)=>l.Date>t.Date?1:-1),x.value=JSON.parse(o.state.cData.tables).sort((l,t)=>l.name>t.name?1:-1)},b=()=>{J.get(F).then(l=>{l.length&&(m.value=l.map(t=>({...JSON.parse(t.datalist),snkey:t.snkey})))})},c=async()=>{let l={snkey:1,maxday:y.value,maxOrderCounts:v.value,holidaySet:JSON.stringify(g.value),additionalHolidaySet:JSON.stringify(k.value),introduce:p.value,memberOnly:D.value,allBookingSet:JSON.stringify(S.value),tables:JSON.stringify(x.value)};J.post("other_data",l).then(async O=>{console.log(O),O.state==1&&(s.$swal({icon:"success",title:"已修改"}),await h(),await C())})},h=async()=>{console.log("getcomp"),await J.get("other_data").then(l=>{let t=l[0];t&&(o.state.cData=t,sessionStorage.setItem("cData",JSON.stringify(t)))},l=>{console.log(l),s.$swal({icon:"error",title:"資料庫未正常連結!! 請按 CTRL+F5 後重新登入~ 或洽系統工程師"})})};return(l,t)=>{const O=e("v-spacer"),T=e("v-btn"),Y=e("v-card-title"),$=e("v-textarea"),A=e("v-card-text"),L=e("v-card"),R=e("v-icon");return u(),N("div",st,[n(et,{ref_key:"WeekContentFn",ref:I,usingDatabase:F,items:m.value,weekContentItems:r,onGetAllData:b},null,8,["items"]),w.value?(u(),B(L,{key:0},{default:i(()=>[n(Y,{class:"d-flex"},{default:i(()=>[t[3]||(t[3]=f("div",{class:"text-h5 font-weight-bold"},"各項設定",-1)),n(O),n(T,{class:"bg-primary",onClick:t[0]||(t[0]=H(U=>c(),["stop"]))},{default:i(()=>[...t[2]||(t[2]=[_("更新目前設定資料",-1)])]),_:1})]),_:1}),n(A,null,{default:i(()=>[f("div",at,[f("div",null,[t[4]||(t[4]=f("h3",{class:"align-self-start mt-6"},"主畫面簡介",-1)),n($,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=U=>p.value=U),class:"ma-1 pa-1 amber lighten-5 rounded","auto-grow":""},null,8,["modelValue"])])])]),_:1})]),_:1})):W("",!0),w.value?W("",!0):(u(),N("div",nt,[t[6]||(t[6]=_(" 資料讀取&處理中... ",-1)),n(R,null,{default:i(()=>[...t[5]||(t[5]=[_("fas fa-spinner fa-spin",-1)])]),_:1})]))])}}},dt=M(ot,[["__scopeId","data-v-52284818"]]);export{dt as default};
